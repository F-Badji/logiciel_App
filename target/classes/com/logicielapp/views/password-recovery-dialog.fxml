<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<AnchorPane xmlns="http://javafx.com/javafx/17.0.2-ea" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.logicielapp.controller.PasswordRecoveryController">
   <children>
      <VBox alignment="CENTER" prefHeight="600.0" prefWidth="500.0" spacing="10.0" 
            styleClass="password-recovery-container">
         <padding>
            <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
         </padding>
         
         <!-- Header -->
         <VBox alignment="CENTER" spacing="10.0" styleClass="header-section">
            <Label fx:id="titleLabel" text="ðŸ” RÃ©cupÃ©ration de Mot de Passe" 
                   styleClass="recovery-title" />
            <Label fx:id="subtitleLabel" text="RÃ©cupÃ©rez vos mots de passe oubliÃ©s en toute sÃ©curitÃ©"
                   styleClass="recovery-subtitle" />
         </VBox>
         
         <!-- Progress Indicator -->
         <HBox alignment="CENTER" spacing="15.0" styleClass="progress-section">
            <Label fx:id="step1" text="1" styleClass="step-indicator, step-active" />
            <Label text="âž¤" styleClass="step-arrow" />
            <Label fx:id="step2" text="2" styleClass="step-indicator" />
            <Label text="âž¤" styleClass="step-arrow" />
            <Label fx:id="step3" text="3" styleClass="step-indicator" />
            <Label text="âž¤" styleClass="step-arrow" />
            <Label fx:id="step4" text="4" styleClass="step-indicator" />
         </HBox>
         
         <!-- Main Content Area -->
         <VBox fx:id="contentArea" alignment="CENTER" spacing="15.0" styleClass="content-area">
            
            <!-- Step 1: Initial Form -->
            <VBox fx:id="initialForm" spacing="15.0" styleClass="form-section">
               <Label text="Informations Requises" styleClass="section-title" />
               
               <VBox spacing="8.0">
                  <Label text="IMEI du tÃ©lÃ©phone (15 chiffres) :" styleClass="field-label" />
                  <TextField fx:id="imeiField" promptText="Exemple: 352807060008769" 
                            styleClass="input-field" />
                  <Label fx:id="imeiValidationLabel" styleClass="validation-message" />
               </VBox>
               
               <VBox spacing="8.0">
                  <Label text="Adresse email de rÃ©cupÃ©ration :" styleClass="field-label" />
                  <TextField fx:id="emailField" promptText="votre.email@exemple.com" 
                            styleClass="input-field" />
               </VBox>
               
               <VBox spacing="8.0">
                  <Label text="Type de mot de passe Ã  rÃ©cupÃ©rer :" styleClass="field-label" />
                  <ComboBox fx:id="passwordTypeComboBox" prefWidth="300.0" 
                           styleClass="combo-input" />
               </VBox>
               
               <Label fx:id="deviceInfoLabel" text="" styleClass="device-info" wrapText="true" />
            </VBox>
            
            <!-- Step 2: Email Verification -->
            <VBox fx:id="emailVerificationForm" spacing="15.0" styleClass="form-section" visible="false">
               <Label text="VÃ©rification Email" styleClass="section-title" />
               <Label fx:id="emailSentLabel" text="" styleClass="info-message" wrapText="true" />
               
               <VBox spacing="8.0">
                  <Label text="Code de vÃ©rification (8 caractÃ¨res) :" styleClass="field-label" />
                  <TextField fx:id="verificationCodeField" promptText="AB12CD34" 
                            styleClass="input-field" maxWidth="200.0" />
               </VBox>
               
               <HBox alignment="CENTER" spacing="10.0">
                  <Button fx:id="resendCodeButton" text="ðŸ”„ Renvoyer le code" 
                         styleClass="secondary-button" />
               </HBox>
            </VBox>
            
            <!-- Step 3: Security Questions -->
            <VBox fx:id="securityQuestionsForm" spacing="15.0" styleClass="form-section" visible="false">
               <Label text="Questions de SÃ©curitÃ©" styleClass="section-title" />
               <Label text="RÃ©pondez aux questions suivantes pour vÃ©rifier votre identitÃ© :" 
                      styleClass="info-message" />
               
               <VBox fx:id="questionsContainer" spacing="12.0">
                  <!-- Questions gÃ©nÃ©rÃ©es dynamiquement -->
               </VBox>
            </VBox>
            
            <!-- Step 4: Password Result -->
            <VBox fx:id="passwordResultForm" spacing="15.0" styleClass="form-section" visible="false">
               <Label text="âœ… RÃ©cupÃ©ration RÃ©ussie !" styleClass="section-title success" />
               
               <VBox spacing="12.0" styleClass="result-container">
                  <Label text="Nouveau mot de passe gÃ©nÃ©rÃ© :" styleClass="field-label" />
                  <HBox alignment="CENTER_LEFT" spacing="10.0">
                     <TextField fx:id="newPasswordField" editable="false" 
                               styleClass="password-result" />
                     <Button fx:id="copyPasswordButton" text="ðŸ“‹ Copier" 
                            styleClass="copy-button" />
                     <Button fx:id="togglePasswordButton" text="ðŸ‘ï¸ Afficher" 
                            styleClass="toggle-button" />
                  </HBox>
                  
                  <Label text="Type de mot de passe :" styleClass="field-label" />
                  <Label fx:id="passwordTypeLabel" styleClass="info-value" />
                  
                  <Label text="Appareil dÃ©tectÃ© :" styleClass="field-label" />
                  <Label fx:id="deviceDetectedLabel" styleClass="info-value" />
                  
                  <Label text="Instructions de configuration :" styleClass="field-label" />
                  <ScrollPane prefHeight="120.0" fitToWidth="true" styleClass="instructions-scroll">
                     <TextArea fx:id="instructionsArea" editable="false" wrapText="true" 
                              styleClass="instructions-text" />
                  </ScrollPane>
                  
                  <Label text="âš ï¸ Important : Changez ce mot de passe dÃ¨s que possible aprÃ¨s rÃ©cupÃ©ration." 
                         styleClass="warning-message" wrapText="true" />
               </VBox>
            </VBox>
         </VBox>
         
         <!-- Status Messages -->
         <VBox alignment="CENTER" spacing="5.0" styleClass="status-section">
            <Label fx:id="statusLabel" styleClass="status-message" wrapText="true" />
            <ProgressBar fx:id="progressBar" prefWidth="300.0" visible="false" styleClass="progress-bar" />
         </VBox>
         
         <!-- Action Buttons -->
         <HBox alignment="CENTER" spacing="15.0" styleClass="button-section">
            <Button fx:id="cancelButton" text="âŒ Annuler" styleClass="cancel-button" 
                   onAction="#handleCancel" />
            <Button fx:id="backButton" text="â¬…ï¸ PrÃ©cÃ©dent" styleClass="secondary-button" 
                   onAction="#handleBack" visible="false" />
            <Button fx:id="nextButton" text="DÃ©marrer âž¤" styleClass="primary-button" 
                   onAction="#handleNext" />
         </HBox>
         
         <!-- Footer Info -->
         <VBox alignment="CENTER" spacing="5.0" styleClass="footer-section">
            <Label text="ðŸ”’ Toutes vos donnÃ©es sont sÃ©curisÃ©es et chiffrÃ©es" 
                   styleClass="security-info" />
            <Label fx:id="sessionInfoLabel" text="" styleClass="session-info" />
         </VBox>
      </VBox>
   </children>
</AnchorPane>
